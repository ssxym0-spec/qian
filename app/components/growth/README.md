# 生长过程页 - 组件文档

## 概述

生长过程页是茶叶溯源网站的核心功能页面之一，以时间轴的形式展示茶园的每日生长状态与农事活动，并提供月度汇总报告。

## 页面路由

- **路径**: `/shengzhang`
- **查询参数**: `?month=YYYY-MM` (可选，默认为当前月份)
- **示例**: `/shengzhang?month=2024-09`

## 文件结构

```
app/
├── shengzhang/
│   └── page.tsx                 # 服务器组件：主页面入口
└── components/
    └── growth/
        ├── types.ts             # TypeScript 类型定义
        ├── GrowthPageClientWrapper.tsx  # 客户端交互容器
        ├── MonthSelector.tsx    # 月份选择器
        ├── CardStream.tsx       # 卡片流
        ├── DailyLogCard.tsx     # 每日日志卡片
        ├── MonthlySummaryCard.tsx  # 月度汇总卡片
        ├── DailyDetailPanel.tsx    # 每日详情面板
        └── MonthlyDetailPanel.tsx  # 月度汇总详情面板
```

## 组件说明

### 1. page.tsx (服务器组件)
**作用**: 主页面入口，负责从后端 API 获取数据

**功能**:
- 接收 URL 查询参数 `searchParams.month`
- 从 `http://localhost:3000/api/public/growth-data?month=YYYY-MM` 获取数据
- 处理错误情况并显示友好的错误信息
- 将数据传递给客户端组件

### 2. GrowthPageClientWrapper.tsx (客户端组件)
**作用**: 客户端交互容器，管理所有交互状态

**状态管理**:
- `openPanel`: 当前打开的面板类型 (`'daily'` | `'monthly'` | `null`)
- `selectedDaily`: 当前选中的每日记录
- `selectedMonthly`: 当前选中的月度汇总

**关键功能**:
- 显示页面标题（动态月份）
- 渲染卡片流
- 控制详情面板的打开/关闭
- 面板打开时锁定背景页面滚动

### 3. MonthSelector.tsx (客户端组件)
**作用**: 月份选择器，固定在页面底部

**功能**:
- 显示 1-12 月的导航按钮
- 高亮当前选中的月份（橘黄色、加粗、放大）
- 点击月份时通过改变 URL 参数刷新页面数据
- 自动识别真实当前月份

**交互**:
- 激活状态：橘黄色、字体变大、背景高亮
- 悬停效果：浅橘色背景
- 点击效果：轻微缩放

### 4. CardStream.tsx (客户端组件)
**作用**: 卡片流容器，负责卡片的排序和渲染

**排序逻辑**:
1. 如果存在月度汇总，置顶显示
2. 每日日志按日期从早到晚排序

**动画效果**:
- 卡片依次淡入（每张卡片延迟 50ms）

### 5. DailyLogCard.tsx (客户端组件)
**作用**: 每日日志卡片

**布局**:
- 左侧 1/3：图片 + 状态标签
- 右侧 2/3：日期、天气、摘要、地块信息

**状态标签优先级**:
1. **异常**（红色）- 最高优先级
2. **农事活动**（多色）
   - 施肥（绿色）
   - 修剪（蓝色）
   - 灌溉（青色）
   - 采摘（琥珀色）
   - 其他农事（绿色）

**交互效果**:
- 悬停：卡片上浮、阴影加深
- 点击：轻微缩放、打开详情面板

### 6. MonthlySummaryCard.tsx (客户端组件)
**作用**: 月度汇总卡片

**布局**:
- 左侧 1/3：视频缩略图 + 播放按钮图标
- 右侧 2/3：月份汇总标题

**视觉特点**:
- 渐变背景（橘黄渐变）
- 橘色边框
- 播放按钮居中叠加

### 7. DailyDetailPanel.tsx (客户端组件)
**作用**: 每日生长详情面板

**布局结构**:
1. **固定顶部导航栏**
   - 返回按钮（左）
   - 标题（居中）
   
2. **图片画廊**（4:3 比例）
   - 支持左右切换
   - 5 秒自动轮播
   - 图片计数器（右下角）
   
3. **图片信息**（三列网格）
   - 拍摄日期 | 地块 | 拍摄人
   
4. **环境数据面板**（2x2 网格）
   - 日照（黄色卡片）
   - 降水（蓝色卡片）
   - 均温（橘色卡片）
   - 湿度（青色卡片）
   
5. **农事与观察区**（白色卡片 + 分割线）
   - 生长日记
   - 当日农事（条件显示）
   - 物候观察（条件显示）
   - 异常处理（条件显示，红色高亮）

**动画效果**:
- 从右侧平滑滑入
- 半透明遮罩淡入
- 背景页面滚动锁定

### 8. MonthlyDetailPanel.tsx (客户端组件)
**作用**: 月度汇总详情面板

**布局结构**:
1. **固定顶部导航栏**
2. **影像画廊**（与每日详情相同交互）
3. **模块化列表**:
   - 🌿 本月采摘统计（采摘次数、鲜叶总重）
   - 📅 本月农事日历（日期 + 活动列表）
   - ⚠️ 本月异常处理（条件显示，日期 + 异常 + 处理）
   - 🌤️ 本月气候数据（月平均气温、总降水量）
   - 📋 下月计划（条件显示）

**视觉特点**:
- 各模块使用不同的背景色和图标
- 数据以卡片形式清晰呈现
- 下月计划使用渐变背景

## API 数据格式

### 请求
```
GET http://localhost:3000/api/public/growth-data?month=YYYY-MM
```

### 响应
```typescript
{
  daily_logs: DailyLog[];      // 每日日志数组
  monthly_summary: MonthlySummary | null;  // 月度汇总（可能为空）
}
```

详细的类型定义请参考 `types.ts` 文件。

## 关键交互流程

### 1. 切换月份
1. 用户点击底部月份选择器中的数字
2. URL 参数改变为 `?month=YYYY-MM`
3. 服务器组件重新获取数据
4. 页面刷新，显示新月份的内容

### 2. 查看每日详情
1. 用户点击每日日志卡片
2. `GrowthPageClientWrapper` 设置 `openPanel='daily'` 和 `selectedDaily`
3. `DailyDetailPanel` 从右侧滑入
4. 背景页面滚动被锁定
5. 用户可以浏览图片、查看详细信息
6. 点击返回按钮或遮罩关闭面板

### 3. 查看月度汇总
1. 用户点击月度汇总卡片（仅在上月记录完成后显示）
2. `GrowthPageClientWrapper` 设置 `openPanel='monthly'` 和 `selectedMonthly`
3. `MonthlyDetailPanel` 从右侧滑入
4. 显示月度统计、农事日历、异常处理等信息

## 样式与动画

### Tailwind 配置
项目使用 Tailwind CSS 进行样式设计，主要颜色：
- **绿色系**: 茶园主题色（`green-50`, `green-600`, `green-700`）
- **橘黄色**: 品牌主色（`orange-500`, `orange-600`）
- **灰色系**: 文本和背景（`gray-50` 到 `gray-800`）
- **红色**: 异常提示（`red-500`, `red-600`）

### 自定义动画
在 `globals.css` 中定义了淡入动画：
```css
@keyframes fadeIn {
  from {
    opacity: 0;
    transform: translateY(20px);
  }
  to {
    opacity: 1;
    transform: translateY(0);
  }
}
```

## 响应式设计

所有组件都支持移动端和桌面端：
- **移动端** (`< 768px`): 
  - 卡片垂直布局
  - 详情面板全屏显示
  - 月份选择器网格紧凑
  
- **桌面端** (`>= 768px`):
  - 卡片水平布局
  - 详情面板占屏幕 50% 宽度
  - 更大的间距和字体

## 使用建议

1. **确保后端服务运行**: 页面依赖 `http://localhost:3000` 的 API 服务
2. **图片优化**: 使用 Next.js 的 `Image` 组件自动优化图片
3. **错误处理**: 页面包含完整的错误处理和友好提示
4. **SEO 友好**: 服务器端渲染确保良好的 SEO 表现

## 未来改进方向

1. 添加骨架屏加载状态
2. 支持图片放大查看（lightbox）
3. 添加搜索和筛选功能
4. 支持导出月度报告
5. 添加分享功能

