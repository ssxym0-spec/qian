# 卡片交互状态功能实现说明

## 功能概述

实现了全局统一的卡片激活状态系统，为所有列表卡片提供脉动实线橙色边框效果（呼吸动画）。

## 核心特性

### 1. 视觉效果
- **默认状态**: 卡片边框为透明，宽度为 2px
- **激活状态**: 脉动实线橙色边框，2px宽，柔和呼吸效果
  - 使用纯 CSS 边框 + 阴影实现，无旋转动画
  - 边框颜色：橙色（orange-500, #f97316），与底部导航栏激活色一致
  - 边框透明度从半透明到不透明循环变化
  - 配合柔和的橙色外发光效果（box-shadow）
  - 4秒完成一次呼吸循环（吸气-呼气），舒缓自然
  - 低调优雅的激活提示，视觉统一性强

### 2. 交互逻辑
- **唯一性**: 每个列表内同时只有一张卡片可以处于激活状态
- **状态转移**: 点击新卡片时，上一张卡片的动态边框消失，新卡片的边框出现
- **状态保持**: 使用 `localStorage` 持久化激活状态
  - 从列表页进入详情页后返回，激活状态仍然保持
  - 帮助用户快速定位之前浏览的位置

### 3. 列表隔离
不同的列表使用独立的激活状态，互不干扰：
- 生长日记卡片列表: `daily-logs`
- 溯源批次卡片列表: `batch-list`
- 首页品类卡片列表: `category-cards`

## 技术实现

### 1. 全局CSS动画 (`app/globals.css`)

```css
/* 脉动实线边框效果 */
@keyframes gentle-pulse {
  0%, 100% {
    border-color: rgba(249, 115, 22, 0.5);  /* orange-500 半透明 */
    box-shadow: 0 0 0 rgba(249, 115, 22, 0);
  }
  50% {
    border-color: rgba(249, 115, 22, 1);    /* orange-500 不透明 */
    box-shadow: 0 0 12px rgba(249, 115, 22, 0.4);
  }
}

.active-card-border {
  border: 2px solid rgba(249, 115, 22, 0.5);
  animation: gentle-pulse 4s ease-in-out infinite;
}
```

**优势**：
- 最简洁的实现方式，直接使用边框属性
- 无需伪元素，DOM 结构更简单
- 纯 CSS 实现，性能优异
- 橙色主题与底部导航栏激活色保持一致（视觉统一）
- 柔和的呼吸动画，低调优雅
- 无旋转动画，视觉干扰最小
- 兼容性极佳，所有现代浏览器完美支持

### 2. 状态管理 Hook (`app/hooks/useActiveCard.ts`)

```typescript
export function useActiveCard(listKey: string) {
  const [activeCardId, setActiveCardId] = useState<string | null>(null);
  
  // localStorage 持久化
  useEffect(() => {
    const storageKey = `active-card-${listKey}`;
    const savedId = localStorage.getItem(storageKey);
    if (savedId) {
      setActiveCardId(savedId);
    }
  }, [listKey]);
  
  return {
    activeCardId,
    setActiveCard,
    isCardActive,
    clearActiveCard
  };
}
```

**功能**：
- 管理列表中卡片的激活状态
- 自动从 localStorage 加载/保存状态
- 提供简洁的 API 供组件使用

### 3. 可复用包装组件 (`app/components/ActiveCard.tsx`)

```typescript
<ActiveCard 
  isActive={isCardActive(card.id)}
  onClick={() => setActiveCard(card.id)}
>
  {卡片内容}
</ActiveCard>
```

**特点**：
- 可选的包装组件，提供更简洁的使用方式
- 支持自定义元素类型（div/a/button）
- 自动应用激活/默认样式

## 已集成的组件

### 1. 生长日志卡片 (`app/components/growth/DailyLogCard.tsx`)

- **修改点**：
  - 添加 `isActive` 属性
  - 根据激活状态动态应用 CSS 类
- **集成位置**: `app/components/growth/CardStream.tsx`
  - 使用 `useActiveCard('daily-logs')` 管理状态
  - 卡片ID格式：`${log.date}-${index}`

### 2. 溯源批次卡片 (`app/suyuan/components/BatchCard.tsx`)

- **修改点**：
  - 添加 `isActive` 和 `onCardClick` 属性
  - Link 组件上应用激活样式
- **集成位置**: `app/suyuan/components/BatchList.tsx`（新建客户端组件）
  - 使用 `useActiveCard('batch-list')` 管理状态
  - 卡片ID：批次的 `_id`

### 3. 首页品类卡片 (`app/page.tsx`)

- **修改点**：
  - `CategoryList` 组件内集成 `useActiveCard('category-cards')`
  - 点击时设置激活状态
  - 卡片ID格式：`category-${idx}`
- **特性**：
  - 点击后跳转到溯源页面
  - 返回首页后仍保持激活状态

## 使用示例

### 在新的列表中使用

```tsx
'use client';

import { useActiveCard } from '@/app/hooks/useActiveCard';
import MyCard from './MyCard';

export default function MyList({ items }) {
  const { isCardActive, setActiveCard } = useActiveCard('my-unique-list-key');
  
  return (
    <div>
      {items.map(item => (
        <MyCard
          key={item.id}
          item={item}
          isActive={isCardActive(item.id)}
          onClick={() => setActiveCard(item.id)}
        />
      ))}
    </div>
  );
}
```

### 在卡片组件中应用

```tsx
interface MyCardProps {
  item: any;
  isActive?: boolean;
  onClick?: () => void;
}

export default function MyCard({ item, isActive = false, onClick }: MyCardProps) {
  return (
    <div
      onClick={onClick}
      className={`
        your-card-styles
        ${isActive ? 'active-card-border' : 'active-card-border-default'}
      `}
    >
      {/* 卡片内容 */}
    </div>
  );
}
```

## 兼容性说明

### CSS 兼容性
- **`@property`**: 现代浏览器支持（Chrome 85+, Safari 15.4+）
- **降级方案**: 不支持的浏览器会显示静态边框，不影响功能
- **性能**: 使用 CSS 动画，GPU 加速，性能优异

### 服务器组件
- Hook 仅在客户端组件中使用
- 服务器组件通过客户端子组件集成（如 `BatchList`）

## 测试建议

### 功能测试
1. **激活状态**：点击卡片，确认边框出现流光效果
2. **唯一性**：点击另一张卡片，确认前一张卡片边框消失
3. **状态保持**：
   - 点击卡片激活边框
   - 点击进入详情页
   - 返回列表页
   - 确认该卡片仍保持激活状态
4. **列表隔离**：在不同页面的列表中测试，确认状态独立

### 视觉测试
1. 边框宽度为 2px
2. 流光顺时针旋转
3. 边框贴合圆角
4. 颜色过渡平滑
5. 悬停效果正常

### 性能测试
1. 检查动画流畅度（60fps）
2. 滚动时无卡顿
3. 多卡片激活切换无延迟

## 优化建议

### 已实现的优化
✅ 使用 CSS 动画而非 JS 动画，性能更好  
✅ 使用伪元素避免额外 DOM 节点  
✅ localStorage 异步读写，不阻塞渲染  
✅ 默认透明边框占位，避免激活时布局抖动

### 未来可选优化
- [ ] 添加边框颜色主题配置（适配深色模式）
- [ ] 支持自定义动画速度
- [ ] 添加边框激活/消失的淡入淡出过渡
- [ ] 提供静态边框的降级样式配置

## 文件清单

### 新建文件
- `app/hooks/useActiveCard.ts` - 激活状态管理 Hook
- `app/components/ActiveCard.tsx` - 可选的包装组件
- `app/suyuan/components/BatchList.tsx` - 批次列表客户端组件

### 修改文件
- `app/globals.css` - 添加流光边框动画
- `app/components/growth/DailyLogCard.tsx` - 添加激活状态支持
- `app/components/growth/CardStream.tsx` - 集成激活状态管理
- `app/suyuan/components/BatchCard.tsx` - 添加激活状态支持
- `app/suyuan/[category]/page.tsx` - 使用 BatchList 组件
- `app/page.tsx` - 首页品类卡片集成激活状态

## 总结

本次实现了一套完整、可复用、高性能的卡片激活状态系统：

1. ✅ **视觉效果精美**：脉动实线橙色边框，柔和呼吸动画，低调优雅
2. ✅ **交互逻辑完善**：唯一性、状态转移、状态保持
3. ✅ **架构设计合理**：Hook + CSS，职责分离
4. ✅ **易于扩展**：新列表只需几行代码即可集成
5. ✅ **性能优异**：纯 CSS 动画，无复杂计算
6. ✅ **用户体验佳**：状态持久化，帮助定位
7. ✅ **视觉统一性强**：橙色与底部导航栏激活色一致，品牌识别度高
8. ✅ **兼容性极佳**：无需 @property，所有现代浏览器完美支持

系统已完整集成到生长日志、溯源批次、首页品类三个主要列表中，可以立即使用和测试。

