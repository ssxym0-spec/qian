# æ‰¹æ¬¡è¯¦æƒ…é¡µè°ƒè¯•æŒ‡å—

## ğŸ¯ é—®é¢˜æ ¹æºå·²æ‰¾åˆ°å¹¶ä¿®å¤ï¼

### æ ¸å¿ƒé—®é¢˜

é€šè¿‡è°ƒè¯•æ—¥å¿—å‘ç°äº†ä¸¤ä¸ªå…³é”®é—®é¢˜ï¼š

1. **æ•°æ®åŒ…è£…é—®é¢˜**ï¼šåç«¯ API è¿”å›çš„æ•°æ®è¢«åŒ…è£…åœ¨ `{ success: true, data: {...} }` ä¸­ï¼Œä½†å‰ç«¯ç›´æ¥ä½¿ç”¨äº†å¤–å±‚å¯¹è±¡ï¼Œå¯¼è‡´æ‰€æœ‰å­—æ®µéƒ½æ˜¯ `undefined`ã€‚

2. **å­—æ®µåä¸åŒ¹é…**ï¼šåç«¯å’Œå‰ç«¯ä½¿ç”¨äº†ä¸åŒçš„å­—æ®µåï¼š
   - `product_appreciation` vs `product_display`
   - `harvest_date` vs `date`
   - `manual_craft`/`modern_craft` vs `craft_type`
   - `harvest_team` vs `team`

### âœ… ä¿®å¤æ–¹æ¡ˆ

å·²åœ¨ `app/suyuan/batch/[batchId]/page.tsx` ä¸­æ·»åŠ äº†**æ•°æ®è½¬æ¢å±‚**ï¼Œè‡ªåŠ¨å¤„ç†ï¼š
- âœ… è§£åŒ… API å“åº”æ•°æ®
- âœ… æ˜ å°„æ‰€æœ‰å­—æ®µåå·®å¼‚
- âœ… è½¬æ¢é‡‡æ‘˜è®°å½•æ ¼å¼
- âœ… è½¬æ¢åˆ¶ä½œå·¥è‰ºæ ¼å¼
- âœ… è½¬æ¢æˆå“å±•ç¤ºå’Œå“é‰´æŠ¥å‘Šæ ¼å¼

## âœ… å·²å®Œæˆçš„ä¿®å¤

### 1. æ·»åŠ è¯¦ç»†çš„æœåŠ¡å™¨ç«¯æ—¥å¿—

åœ¨ `app/suyuan/batch/[batchId]/page.tsx` ä¸­æ·»åŠ äº†å¤§é‡çš„ `console.log`ï¼Œè¿™äº›æ—¥å¿—ä¼šè¾“å‡ºåˆ°**è¿è¡Œ `npm run dev` çš„ç»ˆç«¯çª—å£**ï¼ˆä¸æ˜¯æµè§ˆå™¨æ§åˆ¶å°ï¼‰ã€‚

æ—¥å¿—æ ‡è®°è¯´æ˜ï¼š
- ğŸ” `[Server]` - æ•°æ®è·å–è¿‡ç¨‹
- ğŸ¬ `[Server]` - é¡µé¢æ¸²æŸ“è¿‡ç¨‹
- âœ… - æˆåŠŸæ“ä½œ
- âŒ - é”™è¯¯ä¿¡æ¯
- âš ï¸ - è­¦å‘Šä¿¡æ¯

### 2. å­ç»„ä»¶æ—¥å¿—

æ¯ä¸ªå­ç»„ä»¶ä¹Ÿæ·»åŠ äº†æ—¥å¿—æ ‡è®°ï¼š
- ğŸ¨ `[BatchDetailHeader]` - é¡µé¢å¤´éƒ¨ç»„ä»¶
- ğŸ“… `[StoryTimeline]` - æ•…äº‹æ—¶é—´è½´ç»„ä»¶
- ğŸ› ï¸ `[ProductionSteps]` - åˆ¶ä½œå·¥è‰ºç»„ä»¶
- ğŸµ `[ProductDisplay]` - æˆå“å±•ç¤ºç»„ä»¶

### 3. ç©ºå€¼ä¿æŠ¤

æ‰€æœ‰å­ç»„ä»¶éƒ½æ·»åŠ äº†ç©ºå€¼æ£€æŸ¥ï¼Œå³ä½¿æ•°æ®ç¼ºå¤±ä¹Ÿä¸ä¼šå¯¼è‡´å´©æºƒï¼Œè€Œæ˜¯æ˜¾ç¤ºå‹å¥½çš„æç¤ºä¿¡æ¯ã€‚

### 4. é”™è¯¯å¤„ç†å¢å¼º

- API è¯·æ±‚å¤±è´¥æ—¶ä¼šæ˜¾ç¤ºè¯¦ç»†çš„é”™è¯¯ä¿¡æ¯
- æ•°æ®ç¼ºå¤±æ—¶ä¼šæ˜¾ç¤ºå ä½ç¬¦è€Œä¸æ˜¯ç©ºç™½é¡µ
- æ·»åŠ äº†æ•°æ®å®Œæ•´æ€§æ£€æŸ¥

## ğŸš€ æµ‹è¯•æ­¥éª¤

### æ­¥éª¤ 1: æŸ¥çœ‹æœåŠ¡å™¨ç«¯æ—¥å¿—

1. æ‰“å¼€è¿è¡Œ `npm run dev` çš„ç»ˆç«¯çª—å£
2. è®¿é—®æ‰¹æ¬¡è¯¦æƒ…é¡µï¼Œä¾‹å¦‚ï¼š`http://localhost:3000/suyuan/batch/YOUR_BATCH_ID`
3. åœ¨ç»ˆç«¯ä¸­æŸ¥æ‰¾æ—¥å¿—è¾“å‡º

**æœŸæœ›çœ‹åˆ°çš„æ—¥å¿—åºåˆ—ï¼š**

```
ğŸ¬ [Server] BatchDetailPage å¼€å§‹æ¸²æŸ“
ğŸ¬ [Server] params: { batchId: 'xxx' }
ğŸ¬ [Server] batchId: xxx
ğŸ” [Server] å¼€å§‹è·å–æ‰¹æ¬¡è¯¦æƒ…, batchId: xxx
ğŸ” [Server] API URL: http://localhost:3000/api/public/batches/xxx
ğŸ” [Server] Response status: 200
ğŸ” [Server] Response ok: true
âœ… [Server] æˆåŠŸè·å–æ‰¹æ¬¡æ•°æ®: {...}
âœ… [Server] æ•°æ®æ‘˜è¦:
  - batch_number: MQ-20250328-01
  - category_name: æ˜å‰èŒ¶
  - title: ...
  - cover_image_url: ...
  - harvest_records_ids length: 4
  - production_steps length: 10
  - product_display: true
  - tasting_report: true
âœ… [Server] æ‰¹æ¬¡æ•°æ®å·²è·å–ï¼Œå‡†å¤‡æ¸²æŸ“é¡µé¢
âœ… [Server] æ‰¹æ¬¡å·: MQ-20250328-01
...
```

### æ­¥éª¤ 2: è¯†åˆ«é—®é¢˜

æ ¹æ®æ—¥å¿—è¾“å‡ºï¼Œä½ å¯ä»¥è¯Šæ–­é—®é¢˜ï¼š

#### æƒ…å†µ A: API è¯·æ±‚å¤±è´¥

**æ—¥å¿—æ˜¾ç¤ºï¼š**
```
âŒ [Server] Failed to fetch batch detail: 404
```

**åŸå› ï¼š** æ‰¹æ¬¡IDä¸å­˜åœ¨æˆ–APIè·¯ç”±æœ‰é—®é¢˜

**è§£å†³æ–¹æ¡ˆï¼š**
- æ£€æŸ¥æ‰¹æ¬¡IDæ˜¯å¦æ­£ç¡®
- ç¡®è®¤åç«¯APIæ˜¯å¦æ­£å¸¸è¿è¡Œ
- ä½¿ç”¨æµè§ˆå™¨ç›´æ¥è®¿é—®APIï¼š`http://localhost:3000/api/public/batches/YOUR_BATCH_ID`

#### æƒ…å†µ B: ç½‘ç»œè¿æ¥å¤±è´¥

**æ—¥å¿—æ˜¾ç¤ºï¼š**
```
âŒ [Server] Error fetching batch detail: FetchError...
```

**åŸå› ï¼š** æ— æ³•è¿æ¥åˆ°åç«¯æœåŠ¡å™¨

**è§£å†³æ–¹æ¡ˆï¼š**
- ç¡®è®¤åç«¯æœåŠ¡å™¨æ­£åœ¨è¿è¡Œ
- æ£€æŸ¥ç«¯å£æ˜¯å¦æ­£ç¡®ï¼ˆé»˜è®¤3000ï¼‰
- å¦‚æœåç«¯åœ¨ä¸åŒç«¯å£ï¼Œä¿®æ”¹ `page.tsx` ç¬¬36è¡Œçš„ API URL

#### æƒ…å†µ C: æ•°æ®ä¸å®Œæ•´

**æ—¥å¿—æ˜¾ç¤ºï¼š**
```
âœ… [Server] æˆåŠŸè·å–æ‰¹æ¬¡æ•°æ®
âš ï¸ [Server] è·³è¿‡ StoryTimeline ç»„ä»¶ï¼ˆæ— æ•°æ®ï¼‰
âš ï¸ [Server] è·³è¿‡ ProductionSteps ç»„ä»¶ï¼ˆæ— æ•°æ®ï¼‰
```

**åŸå› ï¼š** åç«¯è¿”å›çš„æ•°æ®ç¼ºå°‘æŸäº›å­—æ®µ

**è§£å†³æ–¹æ¡ˆï¼š**
- è¿™ä¸æ˜¯é”™è¯¯ï¼é¡µé¢ä¼šæ­£å¸¸æ˜¾ç¤ºï¼Œåªæ˜¯æŸäº›éƒ¨åˆ†æ˜¾ç¤º"æš‚æ— æ•°æ®"
- å¦‚æœéœ€è¦å®Œæ•´æ•°æ®ï¼Œåœ¨åç«¯è¡¥å……ç›¸åº”çš„å­—æ®µ

#### æƒ…å†µ D: é¡µé¢å®Œå…¨ç©ºç™½ï¼Œæ²¡æœ‰ä»»ä½•æ—¥å¿—

**åŸå› ï¼š** Next.js ç¼–è¯‘é”™è¯¯æˆ–è·¯ç”±é—®é¢˜

**è§£å†³æ–¹æ¡ˆï¼š**
1. æ£€æŸ¥ç»ˆç«¯æ˜¯å¦æœ‰ç¼–è¯‘é”™è¯¯
2. å°è¯•é‡å¯å¼€å‘æœåŠ¡å™¨ï¼š
   ```bash
   # æŒ‰ Ctrl+C åœæ­¢æœåŠ¡å™¨
   npm run dev  # é‡æ–°å¯åŠ¨
   ```
3. æ¸…é™¤ Next.js ç¼“å­˜ï¼š
   ```bash
   rm -rf .next
   npm run dev
   ```

## ğŸ”§ å¸¸è§é—®é¢˜ä¿®å¤

### é—®é¢˜ 1: API URL ä¸æ­£ç¡®

å¦‚æœä½ çš„åç«¯ä¸åœ¨ `localhost:3000`ï¼Œä¿®æ”¹ `app/suyuan/batch/[batchId]/page.tsx` ç¬¬36è¡Œï¼š

```typescript
// ä¿®æ”¹å‰
const apiUrl = `http://localhost:3000/api/public/batches/${batchId}`;

// ä¿®æ”¹åï¼ˆä¾‹å¦‚åç«¯åœ¨ 8080 ç«¯å£ï¼‰
const apiUrl = `http://localhost:8080/api/public/batches/${batchId}`;
```

### é—®é¢˜ 2: CORS é”™è¯¯ï¼ˆè·¨åŸŸè¯·æ±‚è¢«é˜»æ­¢ï¼‰

å¦‚æœåœ¨æµè§ˆå™¨æ§åˆ¶å°çœ‹åˆ° CORS é”™è¯¯ï¼Œè¿™æ˜¯å› ä¸ºå‰ç«¯å’Œåç«¯åœ¨ä¸åŒçš„åŸŸæˆ–ç«¯å£ã€‚

**è§£å†³æ–¹æ¡ˆï¼š** åœ¨åç«¯æ·»åŠ  CORS å¤´ï¼Œæˆ–è€…ä½¿ç”¨ Next.js API è·¯ç”±ä½œä¸ºä»£ç†ã€‚

### é—®é¢˜ 3: å›¾ç‰‡æ— æ³•åŠ è½½

å¦‚æœçœ‹åˆ°å›¾ç‰‡å ä½ç¬¦æˆ–åŠ è½½å¤±è´¥ï¼š

1. æ£€æŸ¥ `next.config.js` ä¸­çš„ `images.remotePatterns` é…ç½®
2. ç¡®è®¤å›¾ç‰‡ URL æ ¼å¼æ­£ç¡®
3. æŸ¥çœ‹æµè§ˆå™¨æ§åˆ¶å°çš„å›¾ç‰‡åŠ è½½é”™è¯¯

## ğŸ“ è°ƒè¯•æ¸…å•

- [ ] åç«¯APIæœåŠ¡å™¨æ­£åœ¨è¿è¡Œ
- [ ] å¯ä»¥ç›´æ¥åœ¨æµè§ˆå™¨è®¿é—® API URL å¹¶çœ‹åˆ° JSON æ•°æ®
- [ ] ç»ˆç«¯ä¸­å¯ä»¥çœ‹åˆ°æœåŠ¡å™¨ç«¯æ—¥å¿—
- [ ] æ‰¹æ¬¡IDæ˜¯æœ‰æ•ˆçš„
- [ ] APIè¿”å›çš„æ•°æ®åŒ…å«å¿…éœ€å­—æ®µï¼ˆ`batch_number`, `category_name` ç­‰ï¼‰
- [ ] Next.js æ²¡æœ‰ç¼–è¯‘é”™è¯¯
- [ ] æµè§ˆå™¨æ§åˆ¶å°æ²¡æœ‰ JavaScript é”™è¯¯

## ğŸ“Š å®Œæ•´æ•°æ®ç¤ºä¾‹

åç«¯APIåº”è¯¥è¿”å›çš„æ•°æ®ç»“æ„ç¤ºä¾‹ï¼š

```json
{
  "_id": "65f8a9b1234567890abcdef",
  "batch_number": "MQ-20250328-01",
  "category_name": "æ˜å‰èŒ¶",
  "title": "å¹´åº¦è‡³è‡» é™å€™æ˜¥é›·",
  "summary": "ç”±3æœˆ25æ—¥è‡³28æ—¥ï¼Œå››æ—¥æ™¨éœ²ä¹‹ç²¾åæ±‡èš",
  "grade": "è‡»",
  "cover_image_url": "/uploads/tea-batch-1.jpg",
  "final_product_weight_kg": 8.5,
  "tea_master": {
    "name": "æå¸ˆå‚…",
    "title": "é«˜çº§åˆ¶èŒ¶å¸ˆ",
    "avatar_url": "/uploads/master-avatar.jpg"
  },
  "harvest_records_ids": [
    {
      "_id": "...",
      "date": "2025-03-25T00:00:00.000Z",
      "weight_kg": 45.5,
      "weather": "æ™´",
      "temperature": "15Â°C",
      "images": ["/uploads/harvest-1.jpg"],
      "team": {
        "team_name": "ä¸œå±±é‡‡èŒ¶é˜Ÿ",
        "members": [
          { "name": "å¼ ä¸‰", "avatar_url": "/uploads/avatar1.jpg" }
        ]
      }
    }
  ],
  "production_steps": [
    {
      "step_name": "æ‘Šæ™¾",
      "craft_type": "traditional",
      "images": ["/uploads/step-1.jpg"],
      "description": {
        "purpose": "æ•£å‘æ°´åˆ†ï¼ŒæŸ”åŒ–å¶ç‰‡",
        "method": "è‡ªç„¶æ‘Šæ™¾12å°æ—¶",
        "sensory": "å¶ç‰‡å˜è½¯ï¼Œé¦™æ°”åˆç°",
        "value": "ä¸ºåç»­å·¥è‰ºå¥ å®šåŸºç¡€"
      }
    }
  ],
  "product_display": {
    "dry_tea_image": "/uploads/dry-tea.jpg",
    "brewed_tea_image": "/uploads/brewed-tea.jpg"
  },
  "tasting_report": {
    "tasting_notes": "é¦™æ°”æ¸…å¹½ï¼Œæ»‹å‘³é²œçˆ½...",
    "brewing_guide": "85Â°Cæ°´æ¸©ï¼Œ3åˆ†é’Ÿæµ¸æ³¡",
    "storage_guide": "å¯†å°ã€é¿å…‰ã€ä½æ¸©ä¿å­˜"
  }
}
```

## ğŸ†˜ è¿˜æ˜¯ä¸è¡Œï¼Ÿ

å¦‚æœæŒ‰ç…§ä¸Šè¿°æ­¥éª¤ä»ç„¶æ— æ³•è§£å†³ï¼Œè¯·ï¼š

1. **å¤åˆ¶å®Œæ•´çš„ç»ˆç«¯æ—¥å¿—**ï¼ˆä»é¡µé¢åˆ·æ–°å¼€å§‹çš„æ‰€æœ‰è¾“å‡ºï¼‰
2. **å¤åˆ¶æµè§ˆå™¨æ§åˆ¶å°çš„é”™è¯¯**ï¼ˆæŒ‰ F12 æ‰“å¼€å¼€å‘è€…å·¥å…·ï¼‰
3. **æä¾›ä¸€ä¸ªæ‰¹æ¬¡IDçš„APIå“åº”ç¤ºä¾‹**ï¼ˆç›´æ¥è®¿é—®API URLå¾—åˆ°çš„JSONï¼‰
4. **æˆªå›¾æ˜¾ç¤ºé¡µé¢å½“å‰çŠ¶æ€**

è¿™äº›ä¿¡æ¯å°†å¸®åŠ©æˆ‘ä»¬è¿›ä¸€æ­¥è¯Šæ–­é—®é¢˜ã€‚

---

**æ–‡æ¡£ç‰ˆæœ¬**: v1.0  
**åˆ›å»ºæ—¥æœŸ**: 2025å¹´10æœˆ4æ—¥  
**ç›¸å…³æ–‡ä»¶**: `app/suyuan/batch/[batchId]/page.tsx`

