# 品类卡片跳转功能测试说明

## 功能概述

实现了从首页品类卡片点击后，根据卡片的显示顺序编号自动跳转到溯源页面对应品类的功能。

## 实现原理

### 1. 首页品类卡片 (app/page.tsx)
- 每个品类卡片添加了 `data-category-index` 属性，记录其在数组中的顺序编号（从0开始）
- 点击卡片时跳转到 `/suyuan?index={顺序编号}`
- 例如：
  - 第1个卡片（明前茶）：`/suyuan?index=0`
  - 第2个卡片（雨前茶）：`/suyuan?index=1`
  - 第3个卡片（春茶）：`/suyuan?index=2`
  - 第4个卡片（夏茶）：`/suyuan?index=3`

### 2. 溯源页面入口 (app/suyuan/page.tsx)
- 接收 URL 参数中的 `index` 值
- 从首页 API (`/api/public/landing-page`) 获取品类列表
- 根据 `index` 找到对应的品类名称
- 将品类名称转换为 URL slug（使用与 categoryUtils.ts 相同的映射表）
- 重定向到 `/suyuan/{category-slug}`

### 3. 品类名称到 Slug 的映射
```typescript
{
  '明前茶': 'mingqian',
  '雨前茶': 'yuqian',
  '春茶': 'chuncha',
  '夏茶': 'xiacha',
  '秋茶': 'qiucha',
}
```

## 测试步骤

### 1. 启动开发服务器
```bash
npm run dev
```

### 2. 访问首页
打开浏览器访问：http://localhost:3000

### 3. 测试每个品类卡片

#### 测试用例1：点击第1个品类卡片
- **操作**: 点击"明前茶"卡片
- **预期**:
  1. URL 先变为 `/suyuan?index=0`
  2. 显示加载中状态（旋转图标和"正在跳转到品类页面..."文字）
  3. 自动跳转到 `/suyuan/mingqian`
  4. 页面顶部的品类筛选器中，"明前茶"处于选中状态（金色高亮）
  5. 显示明前茶的批次列表

#### 测试用例2：点击第2个品类卡片
- **操作**: 点击"雨前茶"卡片
- **预期**:
  1. URL 先变为 `/suyuan?index=1`
  2. 显示加载中状态
  3. 自动跳转到 `/suyuan/yuqian`
  4. "雨前茶"处于选中状态
  5. 显示雨前茶的批次列表

#### 测试用例3：点击第3个品类卡片
- **操作**: 点击"春茶"卡片
- **预期**:
  1. URL 先变为 `/suyuan?index=2`
  2. 显示加载中状态
  3. 自动跳转到 `/suyuan/chuncha`
  4. "春茶"处于选中状态
  5. 显示春茶的批次列表

#### 测试用例4：点击第4个品类卡片
- **操作**: 点击"夏茶"卡片
- **预期**:
  1. URL 先变为 `/suyuan?index=3`
  2. 显示加载中状态
  3. 自动跳转到 `/suyuan/xiacha`
  4. "夏茶"处于选中状态
  5. 显示夏茶的批次列表

### 4. 边界情况测试

#### 测试用例5：直接访问不带参数的溯源入口页
- **操作**: 在浏览器地址栏输入 `http://localhost:3000/suyuan`
- **预期**: 自动跳转到第1个品类（`/suyuan/mingqian`）

#### 测试用例6：访问无效的 index 参数
- **操作**: 在浏览器地址栏输入 `http://localhost:3000/suyuan?index=999`
- **预期**: 
  - 控制台显示错误信息
  - 自动跳转到第1个品类（`/suyuan/mingqian`）

#### 测试用例7：访问负数 index
- **操作**: 在浏览器地址栏输入 `http://localhost:3000/suyuan?index=-1`
- **预期**: 
  - 控制台显示错误信息
  - 自动跳转到第1个品类（`/suyuan/mingqian`）

## 验证要点

### ✅ 功能正常的标志
1. 点击首页品类卡片后，URL 会先显示 `/suyuan?index={编号}`
2. 短暂的加载动画后，跳转到正确的品类页面
3. 品类筛选器中对应的品类处于选中状态
4. 显示的批次数据与选中的品类一致
5. 浏览器控制台无错误信息（正常的日志除外）

### ❌ 可能的问题
1. **卡片点击无响应**: 检查链接是否正确生成
2. **跳转到错误的品类**: 检查 index 与品类名称的映射是否正确
3. **无限加载**: 检查 API 是否正常返回数据
4. **404错误**: 检查品类 slug 是否匹配

## 调试技巧

### 查看控制台日志
溯源入口页面会输出详细的日志信息：
```
✅ [SuyuanIndex] 品类 #0: 明前茶 -> mingqian
```

### 检查品类数据
在浏览器控制台执行：
```javascript
fetch('http://localhost:3000/api/public/landing-page')
  .then(r => r.json())
  .then(d => console.table(d.categories.map((c, i) => ({ index: i, name: c.name }))))
```

### 检查品类筛选器数据
在浏览器控制台执行：
```javascript
fetch('http://localhost:3000/api/public/categories')
  .then(r => r.json())
  .then(d => console.table(d))
```

## 技术细节

### 为什么使用两次跳转？
1. **首次跳转**: `/suyuan?index=0` - 这是一个客户端路由，用于接收顺序编号
2. **二次跳转**: `/suyuan/mingqian` - 这是实际的品类页面

这种设计的优势：
- 首页只需要知道品类在列表中的位置，不需要知道 slug 映射规则
- 如果未来品类 slug 规则变化，只需要修改 `app/suyuan/page.tsx` 和 `categoryUtils.ts`
- 入口页面可以统一处理错误情况（如无效的 index）

### 数据一致性保证
- 首页的品类列表来自 `/api/public/landing-page`
- 溯源页面的品类列表来自 `/api/public/categories`
- 两个 API 应该返回相同顺序的品类，以确保 index 映射正确

## 后续优化建议

1. **添加过渡动画**: 在跳转过程中添加更流畅的过渡效果
2. **预加载数据**: 在首页就预加载品类到 slug 的映射，减少跳转延迟
3. **URL 美化**: 考虑直接使用品类名称而非 index，例如 `/suyuan/to/mingqian`
4. **错误处理优化**: 提供更友好的错误提示页面
5. **性能优化**: 缓存品类列表数据，避免每次都请求 API

