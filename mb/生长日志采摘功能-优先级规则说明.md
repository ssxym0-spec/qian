# 生长日志采摘功能 - 优先级规则说明

## 📋 概述

采摘功能在生长日志系统中具有**最高优先级**，本文档说明采摘信息在不同场景下的显示规则。

---

## 🏷️ 一、卡片标签优先级

### 规则：采摘标签 > 农事标签

| 场景 | 采摘记录 | 农事活动 | 显示标签 | 位置 |
|------|---------|---------|---------|------|
| 场景1 | ✅ 有 | ✅ 有 | 🟠 已采摘 | 卡片左上角 |
| 场景2 | ✅ 有 | ❌ 无 | 🟠 已采摘 | 卡片左上角 |
| 场景3 | ❌ 无 | ✅ 有 | 🟢 农事标签（如"施肥"） | 图片左上角 |
| 场景4 | ❌ 无 | ❌ 无 | 无标签 | - |

### 视觉示例

#### 场景1：有采摘 + 有施肥
```
┌────────────────────────┐
│ [已采摘] ← 橙色标签     │
│                        │
│  [图片]                │ ← 施肥标签被隐藏
│                        │
│  3月19日  ☀️ 15-26°C   │
└────────────────────────┘
```

#### 场景3：无采摘 + 有施肥
```
┌────────────────────────┐
│                        │ ← 无采摘标签
│  [施肥]  [图片]        │ ← 显示施肥标签
│                        │
│  3月20日  ☁️ 12-18°C   │
└────────────────────────┘
```

### 实现代码
```typescript
{/* 采摘标签 - 卡片左上角 */}
{log.has_harvest && (
  <div className="...">已采摘</div>
)}

{/* 农事标签 - 图片左上角，仅在无采摘时显示 */}
{statusTag && !log.has_harvest && (
  <div className="...">{statusTag.text}</div>
)}
```

---

## 📄 二、详情页内容显示顺序

### 完整显示结构

```
┌─────────────────────────────────────┐
│ [返回] 3月19日 生长记录              │
├─────────────────────────────────────┤
│                                     │
│  📸 图片画廊（4:3 比例）             │
│                                     │
├─────────────────────────────────────┤
│  拍摄日期 | 地块 | 拍摄人            │
├─────────────────────────────────────┤
│                                     │
│  ☀️ 日照  💧 降水  🌡️ 温度  💦 湿度  │ ← 环境数据
│                                     │
├─────────────────────────────────────┤
│  🏗️ 今日采摘                ← ① 优先级1 │
│  ───────────────────────────────────│
│  [头像] 队长   [📦] 重量  [📊] 次数  │
├─────────────────────────────────────┤
│                                     │
│  🌱 当日农事（施肥）         ← ② 优先级2 │
│  今日对茶园进行了有机肥施肥...        │
│                                     │
├─────────────────────────────────────┤
│                                     │
│  📖 生长日记                 ← ③ 优先级3 │
│  茶芽萌动明显，新芽翠绿...            │
│                                     │
├─────────────────────────────────────┤
│                                     │
│  👁️ 物候观察                 ← ④ 优先级4 │
│  茶树进入萌芽期，芽头饱满...          │
│                                     │
├─────────────────────────────────────┤
│                                     │
│  ⚠️ 异常处理                 ← ⑤ 优先级5 │
│  发现少量虫害，已采取措施...          │
│                                     │
└─────────────────────────────────────┘
```

### 优先级排序

| 优先级 | 模块名称 | 图标 | 显示条件 | 说明 |
|-------|---------|------|---------|------|
| **① 最高** | 今日采摘 | 🏗️ | `has_harvest === true` | 独立模块，渐变背景 |
| ② 高 | 当日农事 | 🌱 | `farm_activity_log !== null` | 施肥、修剪等 |
| ③ 中 | 生长日记 | 📖 | `full_log !== null` | 完整日记内容 |
| ④ 低 | 物候观察 | 👁️ | `phenological_observation !== null` | 物候变化 |
| ⑤ 特殊 | 异常处理 | ⚠️ | `abnormal_event !== null` | 红色背景警示 |

### 条件显示规则

所有模块都是**条件显示**，遵循以下规则：
- ✅ 有数据 → 显示模块
- ❌ 无数据 → 不渲染（节省空间）
- 🔀 模块间自动添加分割线

---

## 🎯 三、优先级设计理念

### 为什么采摘优先级最高？

1. **业务重要性**
   - 采摘是茶叶生产的关键环节
   - 直接关系到产量和品质
   - 需要重点追踪和记录

2. **用户关注度**
   - 用户最关心当天是否有采摘
   - 采摘数据（重量、人数）是关键指标
   - 需要一眼就能识别

3. **视觉清晰度**
   - 避免多个标签造成混乱
   - 突出最重要的信息
   - 提升用户体验

4. **信息层次**
   - 采摘 > 农事 > 日记 > 观察
   - 从具体操作到观察记录
   - 从量化数据到文字描述

---

## 📊 四、数据优先级示例

### 示例1：完整采摘日
```
日期: 2025-03-19
采摘: ✅ 有（30.5kg，队长：张三，8人）
农事: ✅ 有（施肥）
日记: ✅ 有
物候: ✅ 有

显示顺序：
① 今日采摘（独立橙色卡片）
② 当日农事（施肥内容）
③ 生长日记
④ 物候观察
```

### 示例2：仅农事日
```
日期: 2025-03-20
采摘: ❌ 无
农事: ✅ 有（修剪）
日记: ✅ 有
物候: ❌ 无

显示顺序：
① 当日农事（修剪内容）
② 生长日记
```

### 示例3：仅采摘日
```
日期: 2025-03-21
采摘: ✅ 有（20kg，队长：李四，5人）
农事: ❌ 无
日记: ❌ 无
物候: ❌ 无

显示顺序：
① 今日采摘（独立橙色卡片）
```

---

## 🔧 五、技术实现

### 卡片标签逻辑
```typescript
// DailyLogCard.tsx

// 采摘标签（优先级高）
{log.has_harvest && (
  <div className="absolute top-2.5 left-2.5 ...">
    已采摘
  </div>
)}

// 农事标签（优先级低，仅在无采摘时显示）
{statusTag && !log.has_harvest && (
  <div className="absolute top-3 left-3 ...">
    {statusTag.text}
  </div>
)}
```

### 详情页显示顺序
```typescript
// DailyDetailPanel.tsx

{/* 环境数据 */}
<EnvironmentPanel />

{/* ① 今日采摘 - 最高优先级 */}
{log.has_harvest && (
  <HarvestSection />
)}

{/* ② 农事与观察区 */}
{(farmActivityLog || fullLog || phenologicalObservation || abnormalEvent) && (
  <div>
    {/* 当日农事 */}
    {farmActivityLog && <FarmActivity />}
    
    {/* 生长日记 */}
    {fullLog && <GrowthLog />}
    
    {/* 物候观察 */}
    {phenologicalObservation && <Phenological />}
    
    {/* 异常处理 */}
    {abnormalEvent && <Abnormal />}
  </div>
)}
```

---

## ✅ 六、测试检查清单

### 卡片标签测试
- [ ] 有采摘+有农事 → 只显示采摘标签
- [ ] 有采摘+无农事 → 显示采摘标签
- [ ] 无采摘+有农事 → 显示农事标签
- [ ] 无采摘+无农事 → 无标签

### 详情页顺序测试
- [ ] 环境数据始终在最上方
- [ ] 采摘信息紧跟环境数据（如果有）
- [ ] 农事信息在采摘之后（如果有）
- [ ] 生长日记在农事之后（如果有）
- [ ] 物候观察在日记之后（如果有）
- [ ] 异常处理在最后（如果有）

### 条件显示测试
- [ ] 各模块仅在有数据时显示
- [ ] 无数据模块不占用空间
- [ ] 模块间分割线正确显示

---

## 📝 七、注意事项

### 1. 数据依赖
- 采摘标签依赖 `has_harvest` 字段
- 详情页依赖完整的采摘数据结构
- 确保后端正确返回所有字段

### 2. 性能考虑
- 使用条件渲染避免不必要的 DOM
- 所有模块都是按需加载
- 图标组件使用按需导入

### 3. 未来扩展
- 可能新增其他类型的标签
- 优先级规则需要灵活调整
- 预留扩展接口

---

**文档版本：** v1.0  
**更新日期：** 2025年10月13日  
**适用范围：** 生长日记页面（前端）

